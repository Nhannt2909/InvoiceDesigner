@page "/User/Account"
@using InvoiceDesigner.Domain.Shared.DTOs.User
@using InvoiceDesigner.WebApp.Helpers;
@inject IHttpClientFactory HttpClientFactory
@inject ILocalStorageService LocalStorageService
@inject NavigationManager nav
@inject ISnackbar Snackbar


<MudContainer>
	@if (_userEditDto == null)
	{
		<MudText Align="Align.Center">Loading...</MudText>
	}
	else
	{
		<EditForm Model="@_userEditDto" OnValidSubmit="OnValidSubmit">
			<DataAnnotationsValidator />
			<MudCard>
				<MudCardContent>
					<MudPaper Class="pa-4">
						<MudTextField @bind-Value="_userEditDto.Name"
									  Label="Name"
									  Required
									  Class="d-flex pa-2"
									  For="(() => _userEditDto.Name)" />
						<MudTextField @bind-Value="_userEditDto.Password"
									  Label="Password"
									  Class="d-flex pa-2"
									  For="(() => _userEditDto.Password)"/>
					</MudPaper>
				</MudCardContent>
				<MudCardActions>
					<MudButton Variant="Variant.Filled" Color="Color.Primary" ButtonType="ButtonType.Submit" Class="ml-auto">Save</MudButton>
				</MudCardActions>
			</MudCard>
		</EditForm>
	}
</MudContainer>
@code {

	private static string _controller = "User/Account";
	private HttpRequestHelper _httpHelper = null!;

	private UserEditDto? _userEditDto = null;

	protected override async Task OnInitializedAsync()
	{
		_httpHelper = new HttpRequestHelper(_controller, HttpClientFactory, Snackbar, LocalStorageService, nav);
		_userEditDto = await _httpHelper.GetAsync<UserEditDto>(1);
	}

	private async Task OnValidSubmit()
	{
		if (_userEditDto == null)
			return;

		await _httpHelper.SendRequest(_userEditDto, true);
	}

}
